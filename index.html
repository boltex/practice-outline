<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Outline Demo</title>
    <style>
        body {
            margin: 0;
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: #f7f7f7;
            border-right: 1px solid #ccc;
            padding: 1rem 1rem 0 0;
            overflow-y: auto;
            font-family: sans-serif;
        }

        .content {
            flex: 1;
            padding: 1rem 0 0 1rem;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            white-space: pre-wrap;
        }

        /* Tree styling */
        ul {
            list-style: none;
            padding-left: 1rem;
            margin: 0;
        }

        /* Each list item: 2-column grid (caret | label) */
        li {
            display: grid;
            grid-template-columns: 1em 1fr;
            align-items: start;
            row-gap: 2px;
            /* space between the row and its children */
            padding: 2px 0;
        }

        /* Caret stays a small target in the first column */
        li>.caret {
            grid-column: 1;
            display: inline-block;
            width: 1em;
            cursor: pointer;
            user-select: none;
        }

        /* Caret glyphs */
        li[data-expanded="true"]>.caret::after {
            content: "▾";
        }

        li[data-expanded="false"]>.caret::after {
            content: "▸";
        }

        /* Label fills remaining width in second column with 'block' */
        li>.node-text {
            grid-column: 2;
            display: block;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
        }

        /* Selected + ancestor styles still just target the label */
        li.selected>.node-text {
            background: #d0e4ff;
        }

        li.ancestor>.node-text {
            background: #e4f1ff;
        }

        /* Children appear underneath the row, same indentation as before */
        li>ul {
            grid-column: 1 / -1;
            margin: 0;
            padding-left: 1rem;
        }

        /* Hide caret if there are no children */
        li:has(> ul:empty)>.caret {
            visibility: hidden;
        }

        /* Collapse children when needed */
        li[data-expanded="false"]>ul {
            display: none;
        }

        /* Articles */
        .article {
            display: none;
        }
    </style>
</head>

<body>
    <!-- 
    data-id distinguishes node positions, the data-gnx identifies body content.
    1 body can be used in multiple positions (nodes).
    Clicking the caret expands/collapses and selects the node. Clickng the text selects only.
    -->
    <div class="sidebar">
        <ul>
            <li data-id="1" data-gnx="1" data-expanded="false">
                <span class="caret"></span><span class="node-text">Section 1</span>
                <ul>
                    <li data-id="2" data-gnx="2" data-expanded="false">
                        <span class="caret"></span><span class="node-text">Page A</span>
                        <ul>
                            <li data-id="3" data-gnx="3" data-expanded="false">
                                <span class="caret"></span><span class="node-text">Subpage A.1</span>
                                <ul></ul>
                            </li>
                            <li data-id="4" data-gnx="4" data-expanded="false">
                                <span class="caret"></span><span class="node-text">Subpage A.2</span>
                                <ul></ul>
                            </li>
                        </ul>
                    </li>
                    <li data-id="5" data-gnx="5" data-expanded="false">
                        <span class="caret"></span><span class="node-text">Page B</span>
                        <ul></ul>
                    </li>
                </ul>
            </li>
            <li data-id="6" data-gnx="6" data-expanded="false">
                <span class="caret"></span><span class="node-text">Section 2</span>
                <ul>
                    <li data-id="7" data-gnx="7" data-expanded="false">
                        <span class="caret"></span><span class="node-text">Page C (Repeated)</span>
                        <ul></ul>
                    </li>
                    <li data-id="8" data-gnx="7" data-expanded="false">
                        <span class="caret"></span><span class="node-text">Page C (Repeated)</span>
                        <ul></ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="content" id="body"></div>

    <script>
        const bodies = {
            "1": "Section 1 content here\nMultiple lines supported.",
            "2": "Page A content here\nMore text.",
            "3": "Subpage A.1 content here",
            "4": "Subpage A.2 content here",
            "5": "Page B content here",
            "6": "Section 2 content here",
            "7": "Page C (Repeated) content here\nSame (body content) GNX used twice, with different (position) IDs.",
        };

        document.addEventListener("DOMContentLoaded", () => {
            const lis = document.querySelectorAll(".sidebar li");
            const bodyDiv = document.getElementById("body");
            let selectedLi = null;

            function selectNode(li) {
                if (selectedLi) selectedLi.classList.remove("selected");

                // Remove previous ancestor highlights
                document.querySelectorAll(".sidebar li.ancestor").forEach(a => a.classList.remove("ancestor"));

                li.classList.add("selected");
                selectedLi = li;

                // Highlight ancestors
                let parent = li.parentElement;
                while (parent && parent.classList) {
                    if (parent.tagName === "LI") {
                        parent.classList.add("ancestor");
                    }
                    parent = parent.parentElement; // move up to the LI parent
                }

                // Show body content
                const id = li.getAttribute("data-gnx");
                bodyDiv.textContent = bodies[id] || "";
            }

            // Caret click: toggle expand + select
            document.querySelectorAll(".sidebar .caret").forEach(caret => {
                caret.addEventListener("click", e => {
                    e.stopPropagation();
                    const li = caret.parentElement;
                    const expanded = li.getAttribute("data-expanded") === "true";
                    li.setAttribute("data-expanded", expanded ? "false" : "true");
                    selectNode(li);
                });
            });

            // Text click: select only
            document.querySelectorAll(".sidebar li > span.node-text").forEach(span => {
                span.addEventListener("click", e => {
                    e.stopPropagation();
                    selectNode(span.parentElement);
                });
            });

            // Auto-select first node
            if (lis.length > 0) selectNode(lis[0]);
        });
    </script>

</body>

</html>